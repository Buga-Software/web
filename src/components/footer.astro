---
const weatherApi = import.meta.env.VITE_WEATHER_API_KEY;
const CurrentYear = new Date().getFullYear();
---

<footer class="relative py-12 px-6 md:px-36 flex flex-col md:flex-row justify-between items-center text-[var(--text-primary)] gap-6 mt-auto">
  <hr class="absolute top-0 left-0 w-full border-t border-white/15" />
  <div class="flex flex-col gap-3 text-center md:text-left">
    <div>
      <p class="text-sm font-light">Â© {CurrentYear} <span class="font-medium">Buga Software</span></p>
      <p class="text-xs text-[var(--text-secondary)]">Todos los derechos reservados.</p>
    </div>

    <div class="flex flex-col gap-2 md:flex-row">
      <div class="flex items-center gap-3 text-sm px-4 py-1 rounded-lg border border-white/15 backdrop-blur-md bg-white/5 justify-between">
      <span id="horaColombia" class="tracking-wide">--</span>
        <span class="flex items-center gap-1 text-green-500 font-semibold">
        <span class="inline-block w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
        Activos
      </span>
    </div>

    <div class="flex gap-3 text-sm px-4 py-1 rounded-lg border border-white/15 backdrop-blur-md bg-white/5 justify-center">
      <span id="climaBuga" data-api-key={weatherApi}>Cargando clima...</span>
    </div>
  </div>
  </div>

  <div class="p-2 hover:scale-105 transition-transform duration-300">
    <img src="/favicon.svg" alt="Buga Software Logo" class="w-12 h-12 opacity-90 hover:opacity-100" />
  </div>
</footer>

<script lang="ts">
  function actualizarHora() {
    const ahora = new Date().toLocaleTimeString("es-CO", {
      timeZone: "America/Bogota",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    });
    document.getElementById("horaColombia").textContent = ahora + " ðŸ‡¨ðŸ‡´";
  }

  actualizarHora();
  setInterval(actualizarHora, 1000);

  async function actualizarClima() {
    const climaEl = document.getElementById("climaBuga");
    const apiKey = climaEl.dataset.apiKey;

    const url = `https://api.openweathermap.org/data/2.5/weather?lat=3.54&lon=76.18&appid=${apiKey}&units=metric&lang=es`;
    
    try {
      const response = await fetch(url);
      const data = await response.json();

      if (data.cod !== 200) throw new Error(data.message);

      const temp = Math.round(data.main.temp);
      const desc = data.weather[0].description;
      const icon = `https://openweathermap.org/img/wn/${data.weather[0].icon}.png`;

      climaEl.innerHTML = `
        <img src="${icon}" alt="${desc}" class="w-5 h-5 inline-block" />
        ${temp}Â°C  ${desc}
      `;
    } catch (error) {
      climaEl.textContent = "Cargando clima...";
    }
  }

  actualizarClima();
  setInterval(actualizarClima, 600000);
</script>
